                    Background        Through the use of recently developed DNA arrays it is        now possible to obtain accurate quantitative relative        measurements of a large proportion of the mRNA species        present in a biological sample DNA arrays have been used        to monitor changes in gene expression during important        biological processes for example cellular replication and        the response to changes in the environment and to study        variation in gene expression across collections of related        samples such as tumor samples from patients with cancer        A major challenge in interpreting these results is to        understand the structure of the data produced by such        studies which often consist of millions of measurements A        variety of clustering techniques have been applied to such        data and have proved useful for identifying biologically        relevant groupings of genes and samples                      Although the underlying        principles and computational details of these methods        differ they share the goal of organizing the elements        under consideration such as genes into groups clusters        with coherent behavior across relevant measurements such        as samples Generally absent is any consideration of the        nature of the coherent variation For example one might        want to identify groups of genes that have coherent        patterns of expression with large variance across samples        or groups of genes that optimally separate samples into        predefined classes such as different clinical response        groups in tumor samples Here we introduce a new        statistical method which we call gene shaving that        attempts to identify groups of elements genes that have        coherent expression and are optimal for various properties        of the variation in their expression        Figure shows the dataset used in our study which        consisted of  gene expression measurements on         patients with diffuse large Bcell lymphoma DLCL These        data have been described in detail previously   The        column labels refer to different patients and the rows        correspond to genes The order of rows and columns is        arbitrary        Some authors have recently explored the use of        clustering methods to arrange the genes in some systematic        way with similar genes placed close together see   for        developments and   for an overview In Figure  we        have applied hierarchical clustering to the genes and        samples separately Each clustering produces a nonunique        ordering one that ensures that the branches of the        corresponding dendrogram do not cross Figure displays the        original data with rows and columns ordered        accordingly        Some structure is evident in Figure  and this method        can be used to recognize relationships among the genes and        samplesWith any method that reduces the dimension of the        data however finer structure can be lost For example        suppose the expression of some subset of genes divides the        samples in an informative way correlating with the rate of        proliferation of tumor cells for example whereas another        subset of genes divides the samples a different way        representing the immune response for example Then methods        such as twoway hierarchical clustering which seek a        single reordering of the samples for all genes cannot find        such structure        The method of gene shaving we describe here is designed        to extract coherent and typically small clusters of genes        that vary as much as possible across the samples Figure        shows three gene clusters for the DLCL data found using        shaving Some of the genes within each cluster lie close to        each other in the hierarchical clustering of Figure  but        others and the clusters themselves are quite far        apart        In Figure the samples have been ordered by values of        the average gene expression This average gene is a good        representative of the cluster as all the members are so        similar The variance measures at the top of each cluster        are discussed in more detail later The clusters are all of        different sizes We use an automatic method for determining        the size of the clusters based on a randomization        procedure that protects us from looking too hard in the        large sea of genes and finding spurious structure The        three clusteraverage genes one from each cluster are        reasonably uncorrelated see below and Figure  This is        another aspect of the shaving process  it seeks different        clusters where difference is measured by correlation of        the cluster mean Figure shows the results of a        hierarchical clustering applied to the three columnaverage        genes Whereas hierarchical clustering suggests two main        gene groupings the shaving process may suggest more useful        groupings        This article is organized as follows In the section        Gene shaving we describe the method itself The section        entitled The gap estimate of cluster size outlines the        gap test for choosing the cluster size In the section        Predicting patient survival we try to predict patient        survival from gene cluster averages Supervised shaving        is discussed in the following section Finally in the        Conclusions we propose some further generalizations A        more statistical treatment of gene shaving is given in                             Results                  Gene shaving          In this section we describe in detail our technique          for finding clusters like the example in Figure  A gene          expression matrix is an           N            p matrix of realvalued          measurements           X  x                       ij             The rows are genes the columns are samples and x                                ij            is the measured log expression relative to a          baseline Typically there are missing entries in           X We use a technique described in            an iterative algorithm based on the singular value          decomposition for imputing missing expression valuesour          analysis here assumes that           X has no missing values          Let           S                       k            be the indices of a cluster of           k genes and          be the collection of           p column averages of the expression          values for this cluster Then for each cluster size           k gene shaving seeks a cluster           S                       k            having the highest variance of the column          averages          The important question of how to choose the cluster          size           k is addressed in the next          section          Our procedure generates a sequence of nested clusters           S                       k             in a topdown manner starting with           k  N the total number of genes          and decreasing down to           k   gene At each stage the          largest principal component of the current cluster of          genes is computed This eigen gene is the normalized          linear combination of genes with largest variance across          the samples We then compute the inner product          essentially the correlation of each gene with the eigen          gene and discard shave off a fraction of the genes          having lowest absolute inner product The process is          repeated on the reduced cluster of genes The shaving          algorithm is depicted in Figure and given in detail in          Box           There are a number of duplicate genes in the dataset          In some cases the sequence for a given gene appears on          the microarray more than once either by design or by          accident In other cases more than one different EST          expressed sequence tag is present for the same gene          Gene shaving can be affected by duplicate genes since          they are highly correlated with each other We therefore          averaged expression profiles for the duplicate genes          leaving  unique gene profiles          The sequence of operations  in Box gives the first          cluster of rows  the first ribbon in Figure  Step           orthogonalizes the data to encourage discovery of a          different uncorrelated second cluster Note that          although we work with the orthogonalized matrix in the          shaving process for the second and subsequent clusters          the derived clusters and their averages involve the          original genes          The shaving process requires repeated computation of          the largest principal component of a large set of          variables If naively implemented this requires the          construction of a           N            N sample covariance matrix  of the          genes and the computation of its largest eigenvector We          can avoid the computational burden by working in the dual          space where the matrices have dimension           p            p Furthermore as we require only          the largest eigenvector the computations can be reduced          even further by using the power method using the          eigenvector of the previous cluster as a starting          value          The three resulting clusters are shown in Figure and          again in Figure  Figure shows the pairwise          scatterplots of each of the three column averages super          genes from the clusters The absolute correlations          range from  to  The full gene names for the          members of the first three clusters are given in Table                    It is useful to evaluate how much of the          dimensionality of the gene expression variation is          captured by the clusters derived from gene shaving We          can approximate the expression profile for each gene in          the complete dataset as a linear combination of the three          super genes from each cluster which are simple averages          of the genes in each cluster The percent variance          explained by the first           j     super genes is          shown in Figure           Thus the three gene clusters involving a total of           genes explain about  of the variation The percent          variance explained by the first           j principal components broken          curve exceeds that from gene shaving Each principal          component gives a nonzero weight to all  genes          however                          The gap estimate of cluster size          Each shaving sequence produces a nested set of gene          clusters           S                       k             starting with the entire expression matrix and          then proceeding down to some minimum cluster size          typically  If we applied this procedure to null data          in which the rows and columns were independent of each          other we could still find some interestinglooking          patterns in the resulting blocks Hence we need to          calibrate this process so that we can differentiate real          patterns from spurious ones Even in the case of real          structure it is unlikely that a distinct set of genes is          correct for a cluster and the rest not More likely          there is a graduation of membership eligibility and we          have to decide where to draw the line Here we describe a          procedure based on randomization that helps us select a          reasonable cluster size          Our method requires a quality measure for a cluster          We favor both highvariance clusters and high coherence          between members of the cluster As the generation of the          cluster sequence was driven strongly by the former we          focus on the latter in selecting a good cluster By          analogy with the analysis of variance for grouped data          we define the following measures of variance for a          cluster           S                       k                                          The between variance is the variance of the signed          mean gene The within variance measures the variability          of each gene about the cluster average also averaged          over samples As this can be small if the overall          variance is small a more pertinent measure is the          betweentowithin variance ratio           V                       B                       V                       W             or alternatively the percent variance          explained          A large value of           R implies a tight cluster of          coherent genes This is the quality measure we use to          select a cluster from the shaving sequence           S                       k                      Let           S                       k            index the clusters of a given shaving sequence with                    k being the number of genes Let           D                       k            be the           R measure for the           k th member of sequence We wish to          know whether           D                       k            is larger than we would expect by chance if the          rows and columns of the data were independent          Let           X            b be a permuted data matrix          obtained by permuting the elements within each row           of X We form           B such matrices indexed by           b             B  Let           D                       k                       b be the           R measure for cluster S                       k                       b  Denote by                       k            the average of           D                       k                       b over           b  The           Gap function is defined by          We then select as the optimal number of genes that          value of           k producing the largest gap          The idea is that at the value the observed variance is          the most ahead of expected Multiple clusters are          produced for the randomized data just like for the          original data and the gap test is used repeatedly to          select the cluster size at each stage          For the DLCL data the maximum for the first cluster          occurs at eight genes Figure shows the percentvariance          curves           D                       k             for both the original and randomized tumor data as          a function of size and the gap curves used to select the          specific cluster sizes in Figure                           Predicting patient survival          One important motivation for developing gene shaving          was the wish to identify distinct sets of genes whose          variation in expression could be related to a biological          property of the samples In the present example finding          genes whose expression correlates with patient survival          is an obvious challenge Group factors           g                       g                       g            were created by splitting each gene          cluster in Figure into two groups of  patients We          used each of these groupings as a factor in Coxs          proportional hazards model for predicting overall          survival   Of the group factors only           g            was significant at the  level                     p            In   a cluster of  genes was chosen on the          basis of their large variation over samples and their          germinal center Blike or activated Blike expression          profiles Using these  genes a hierarchical          clustering produced two groups of patients which were          just statistically different in survival Close          inspection shows that  of the  genes in the second          cluster above also fall into this cluster of  genes          Hence gene shaving can find clinically and biologically          relevant subdivisions in gene expression data in an          unsupervised fashion          It may be fortuitous that one of these groupings          correlates with survival as the clusters were not chosen          with survival in mind We next describe a modification of          gene shaving that explicitly looks for clusters that are          related to patient survival                          Supervised shaving          The methods discussed so far have not used information          about the columns to supervise the shaving of rows          Here we generalize gene shaving to incorporate full or          partial supervision          As in Equation  we consider a cluster of genes           S                       k            having column average vector  Let           y             y                       y                        y           p  be a set of auxiliary measurements          available for the samples For example each           y                       j             might be a survival time for the patient          corresponding to sample           j or a class label for each sample          such as a diagnosis category Supervised shaving          maximizes a weighted combination of column variance and          an information measure           J             y           for fixed      The value    gives full          supervision values between o and  provide partial          supervision          Choice of the measure           J             y  depends on the nature of the          auxiliary information           y  If the           y codes class labels           J             y  can be taken as the sum of          squared differences between the category averages  For          censored survival times           y  think of as a covariate in a          Cox proportional hazards model If the score vector          from this model is           g we set           J             y             gg           T  a           p            p matrix Computationally we first          scale the genes so that the withinrisk set variance is                    When fully supervised the shaving procedure reduces          to simply ranking the genes from largest to smallest Cox          model score test Thus there is no role for principal          components or topdown shaving in this case However to          encourage coherence within the gene clusters it can be          better to use a partially supervised criterion which          does use principal components and topdown shaving This          is demonstrated in the example below One can also          include other prognostic factors in the model and direct          shaving to find a gene cluster whose column average is a          strong predictor in the model This can be done with          other models for example a linear regression model for a          quantitative measurement Operationally all of these          choices for           J are quadratic functions of the          column averages  and gene shaving can be carried out via          principal components of a suitably modified variance          matrix          We applied supervised shaving to the set of  genes          from the DLCL samples Figure examines the effect of          different values of the supervision weight  showing the          average absolute gene correlation and Cox model           p value for each choice From this          plot we chose the value    which gives a good mix          of high gene correlation and low           p value Partially supervised gene          shaving produced a cluster with  genes shown in          Figure and in Table           Some of the genes are close together in the          hierarchical clustering order indicated by the first          number in Table  many are not Some genes have a          negative sign and others have no sign We will call          these negative and positive genes respectively The          negative genes have their expression values flipped          before being averaged with other gene expression          profiles Figure ashows the gap curve suggesting a          cluster size of  However further analysis below          suggests the better cluster size of           The cluster of  genes contains many of the          strongest individual genes for predicting survival For          example  of the strongest  genes are in the          cluster Some weaker genes are however also in the          cluster the weakest being the nd strongest gene          among the full list of  Figure bshows the survival          curves stratified by the low and high expression of this          gene cluster using the median of the cutoff point The          two resulting groups are shown in Figure           Using this grouping as a predictor in the Cox model          for survival gave a highly significant           p value  However this           p value must be scrutinized Figure          a bshows the Cox model           p value as a function of the          cluster size for both partially and fully supervised          shaving We will call these the training set           p values As the gene shaving          process was supervised by the survival times the          training set           p values will be biased downward          and it is important to adjust them appropriately We          permuted the survival times reran the shaving process          and computed the corresponding           p values This was repeated           times and for each cluster size we computed the          proportion of times the permutation           p values were less than or equal to          the training set           p values These proportions are          shown in Figure c d and are unbiased estimates of the          true           p values Fully supervised shaving          is too aggressive and the upward adjustment of the           p values is large As a result the           p value is around  for the full          set of genes but none of the smaller clusters is          significant at the  level For partially supervised          shaving many of the           p values are below  and from          this we chose the cluster size of  near the          minimum          Using the full set of genes flipping each to have          positive correlation with survival averaging their          expression values and finally cutting at the median gave          a grouping nearly the same as Groups  and  in Figure           The only change was a swap between DLCLoo and          DLCLoo and these two samples are right at the median          cutpoint between the two groups in Figure           The international prognostic index IPI A score was          also available for these patients Components of the IPI          include age level of the enzyme lactate dehydrogenase          LDH and the number of extranodal sites As in   we          dichotomized IPI scores into low   or  and high            or  The resulting grouping seems to be about as          predictive as the IPI index and is quite independent          from it as Table indicates          When added to a Cox model containing IPI this          grouping had a training set           p value of  Figure shows          the KaplanMeier survival curves for each group          stratified by low and high IPI          In   two patient groups were defined from a          hierarchical clustering tree grown from a ogene          cluster As a predictor the grouping was just          significant in the low IPI group only at the  level          Table gives a crosstabulation of that grouping with the          one used in this paper in Figure           Thus    of the patients are classified the          same way by both groupings The patient grouping of          Alizadeh           et al   was based on a cluster          of  genes chosen for their large variation over the          samples Our cluster of  genes has  genes in common          with this cluster of  and they are indicated by an          asterisk in Table  Five of the  genes also appear in          the unsupervised clusters found earlier in the second of          the three clusters                            Conclusions        We have proposed a set of shaving methods for        isolating interesting clusters of genes from a set of DNA        microarray experiments The methods may be unsupervised or        may be supervised  that is use information available        about the samples such as a class label or survival time        The proposed shaving methods search for clusters of genes        showing both high variation across the samples and        coherence correlation across the genes Both of these        aspects are important and cannot be captured by simple        clustering of the genes or thresholding of individual        genes based on the variation over samples        With our modelbased approach for supervised shaving        one can incorporate other prognostic factors in the search        for interesting gene clusters If an outcome such as        survival time is available for each sample the method        searches for a gene cluster whose column average gene has a        significant effect possibly the presence of other        prognostic factors for predicting the outcome        The microarray data         x         ij  we have considered are        realvalued expression levels However other kinds of        arrays produce different kinds of data In particular some        arrays detect the presence or absence of singlenucleotide        polymorphisms SNPs so that the         x         ij  values take on one of         k   unordered values The shaving        methods described can be easily modified to handle this        kind of data In detail we construct         k data matrices         X                   X                   X         k   each of size         n          m  The         ij th element of         X                   j          is  if x                   ij          falls in class         j and zero otherwise Letting                    j                  j             k be the         n          n covariance matrices of the genes in        each         X                   j           we simply apply principal component shaving using                           j           as the variance matrix for the penalty This can be        done unsupervised or a supervision term can also be        added            