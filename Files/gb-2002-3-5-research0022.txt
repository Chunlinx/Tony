                    Background        Microarrays are used to measure the relative        expression levels of thousands of genes or expressed        sequence tags A comparison of gene expression in cells or        tissues from two conditions may provide useful information        on important biological processes or functions    The        challenge now is how to detect those genuine changes from        noisy data It is now known that simply using fold changes        as in the earlier days is unreliable and inefficient           More sophisticated statistical methods are called for        Many proposals have appeared in the literature                 In particular it has been noticed that it        may be necessary to design an experiment that uses multiple        arrays or multiple spots on each array containing        multiple measurements for each gene under each condition        One reason is that because of a high noisetosignal ratio        a single array may not provide enough information that can        be reliably extracted   More important multiple        measurements from each gene make it possible to assess the        potentially different variability of genes The problem        then seems to fall within the traditional twosample        comparison in statistics Two of the best known twosample        statistical tests are the twosample         t test and the Wilcoxon test or        equivalently MannWhitney test The         t test is parametric and is based on        the assumption that the geneexpression levels have normal        distributions In contrast the Wilcoxon test is        nonparametric and is based on the ranks of observed        geneexpression levels Although the         t test is robust to departures from        normality and the Wilcoxon test does not depend on the        normality assumption the problem is that under nonnormal        situations the         t test may be too conservative and        hence as with the Wilcoxon test may have too low power        especially when the sample size is small which is the case        for most microarray experiments These points have been        verified in two case studies using real data    In a        class of nonparametric approaches     a version of        the twosample         t statistic is used but its null        distribution is estimated nonparametrically rather than        directly assumed to be a         t distribution In addition some        earlier studies have suggested that the variability of gene        expression may be related to the mean expression            Therefore it implies that the         t statistic being used should be        based on unequal variances for the two samples        An important and natural question often asked by        biologists is how many replicates are required For        microarray experiments unlike many other experimental        contexts this issue has rarely been discussed in the        literature To our knowledge the only exception is the        work by Black and Doerge   which however is for the        situation where parametric statistical methods are applied        to detect expression changes In this paper we discuss the        problem when a nonparametric method the normal mixture        model approach   is used to detect differential        expression But to facilitate calculations of sample size        the formulation is slightly changed from their original        one Nonparametric methods of microarray data analysis have        been pioneered by Efron and Tibshirani and coworkers           They take advantage of the presence of replicates and        thus can impose much weaker modeling assumptions For        instance the parametric methods of Black and Doerge          depend on the assumption on the lognormal or gamma        distribution of geneexpression levels whereas the mixture        model approach does not have such a distributional        assumption and directly estimates distributions related to        random errors Note that modeling the distribution of        random errors has advantages over direct modeling of        expression levels and is a common practice in applied        statistics For example geneexpression levels may be        correlated for example as a result of coexpression of        some genes whereas random errors can be more reasonably        assumed to be independent This is similar to modeling        longitudinal data using a linear mixedeffects model          the responses from each subject corresponding to a group        of coregulated genes here are in general correlated but        the measurement errors from the same subject can be        considered to be independent after incorporating a        randomsubject effect in the model Note that the random        effect will be canceled out from the         t statistic for each gene Our        proposal here also shows an attractive feature of the        mixture model approach as compared to the other two        nonparametric approaches    because it is still        unclear how the sample sizepower calculation can be done        in the other two approaches        The problem of calculating the number of replicates        required in a microarray experiment is similar to that of        sample sizepower calculations in clinical trials and other        experiment designs the tobedetermined sample size in        microarray experiments refers to the number of replicates        whereas the number of genes is not an issue here As usual        we assume that the replicates are approximately        independent with each other whether they are drawn from        the same individual or multiple individuals In general        the required sample size depends on several factors the        true magnitude of the change of gene expression say         d  the desired statistical power        that is probability   to detect the change and the        specified Type I error rate   The problem of how to        calculate the number of replicates for any given triplet          d    is equivalent to that of how        the power depends on the pair          d   and the number of replicates        which we consider in the paper        The proposed method is not restricted to any specific        microarray technology From now on the expression level        can refer to a summary measure of relative        redtogreenchannel intensities in a fluorescencelabeled        cDNA array a radioactive intensity of a radiolabeled cDNA        array as used in the example later or a summary        difference of the perfect match PM and mismatch MM        scores from an oligonucleotide array The geneexpression        levels may have been suitably preprocessed including        dimension reduction data normalization and data        transformation                          Results and discussion                  A statistical model          We consider a generic situation that for each gene           i I             N we have relative expression          levels           X                      i             X                       mi            from           m microarrays under condition           and           Y                      i             Y                       mi            from           m arrays under condition  We need          to assume that           m is an even integer A general          statistical model is assumed for gene expression          data                    X                       ji                                  i                         ji                        Y                       li                                  i             e                       li                      where                      i  and                      i  are the mean expression          levels for gene           i under the two conditions          respectively and                       ji            and           e                       li            are independent random errors with means and          variances                    for any           j             m            l             m and           i             N  It is assumed that random          errors                       ji                                  i  and are randomly taken          respectively from one of two not necessarily equal          distributions that are symmetric about their mean  Note          that the above assumption on the distributions of random          errors not on that of gene expression levels that is           X                       ji            and           Y                       li             is often reasonable and similar assumptions are          common in other statistical applications In addition we          do not assume that the expression levels of all the genes          have an equal variance because some previous studies              have found that the variance                       c            i  for           c   of geneexpression levels          may depend on the mean expression                      c            i   Also we do not even need          to assume that                       i                         i  unless                      i                        i            A goal is to detect all genes with                      i                        i   This can be accomplished          through statistical hypothesis testing                          A test statistic          To test the null hypothesis           H                                  i                        i   we use a           t type test statistic or score                    Note that the mean and variance of           Z                       i            are                    whereas the mean           E            Z                       i               under           H             Hence it can be seen that a large          absolute value of           Z                       i                        Z                       i             gives evidence against           H             As the number of arrays that is           m  increases the variance of the          test statistic           Z                       i            decreases Hence it is possible to reject           H            that is detect differential          expression for gene           i  with any           E            Z                       i               if           m is large enough In other words          if the Type I error rate and other parameters are fixed          then the statistical power of the test will increase as           m increases This is the key point          that motivates the discussion on sample size          calculations          To determine the cutoff point for            Z                       i             to reject           H             we need to know or estimate the          distribution of           Z                       i            under           H             the null distribution           f             In a parametric approach based on          some full distributional assumptions for           X                       ji            and           Y                       ji             one may derive the null distribution           f             such as in a twosample           t test However the validity of          such a parametric method critically depends on the          correctness of assumed distributions which of course is          not guaranteed Here we consider a nonparametric          approach a finite normal mixture model is used to          estimate           f            nonparametrically                          Estimating the null distribution          There may be various ways to estimate the null          distribution           f             For instance using expression          levels of some housekeeping genes that are known to have          nondifferential expression one can construct their           Z                       i            scores and then estimate           f            using the obtained           Z                       i            scores In practice however there may be only a          small number of or no housekeeping genes in a given          experiment Here following the basic idea in a class of          nonparametric methods     we construct a null          score           z                       i            for each gene and then use these null scores to          estimate           f            nonparametrically The null score is          constructed from the same observed gene expression data          as used in           Z                       i                                Under the assumption that                       ji            and           e                       ji            have symmetric distributions then                       ji            and                        ji            have the same distribution and           e                       ji            and            e                       ji            have the same distribution Thus by comparing the          form of           z                       i            with that of           Z                       i             we know that the distribution of           z                       i            is exactly           f             the null distribution for           Z                       i            under           H             Note that under           H                                  i                        i   and hence                      i                        I  since we assume that                      c            i  only depends on                      c            i   then                    Thus           z                       i            and           Z                       i            have the same distribution           f            under           H             We use all           z                       i            values across all genes to estimate           f                      In practice                      c            i  for           c    are unknown and can be          estimated using the sample standard deviations SDs           s                      c            i   Although the sample SD           s                      c            i  is asymptotically unbiased          if           m and           n are small           s                      c            i  may not be stable and some          modifications may be necessary In any case substituting                               c            i  by any suitable estimates          we can calculate the scores           z                       i            values and           Z                       i            values on the basis of which we can estimate           f            and           f respectively By comparing           f            and           f  we can gain insight about genes          with altered expression that is                      i                        i            We assume that all the           z                       i            values for           i             N are a random sample from           f             thus we can use the observed           z                       i            values to estimate           f             Pan           et al    proposed estimating           f            using a finite normal mixture model            Specifically it is assumed that                    where            z            a                       r                       V                       r             denotes the density function of a normal          distribution           N            a                       r                       V                       r             with mean           a                       r            and variance           V                       r             and                       r            values are mixing proportions                      g  represents all unknown          parameters                        r                       a                       r                       V                       r                        r             g             in a           g            component mixture model Among          others a normal mixture is essentially nonparametric and          flexible and easy to use with stable tail          probabilities          A mixture model can be fitted by maximum likelihood          using the expectationmaximization EM algorithm              The number of components can be selected          adaptively using the Akaike Information Criterion AIC            or the Bayesian Information Criterion BIC   In          using the AIC or BIC one first fits a series of models          with various values of           g             then picks up the           g            corresponding to the first local          minimum of AIC or BIC   Some empirical studies seem          to favor the use of BIC                            Determining the cutoff point          Once we obtain an estimate of the null distribution           f             we can determine the cutoff point          of the rejection region for testing           H             In general as for a twosample          test the rejection region can be selected in the tails          of           f            because under the null hypothesis           Z                       i            should be close to the center of           f             whereas if there is differential          expression for gene           i            Z                       i            is likely to be in one of the two tails of           f             The specific choice may depend on          the goal of the analysis For example if we are only          interested in detecting upregulated genes we can choose          the rejection region at the righttail of           f             Our proposed method works for any          specified way of determining the rejection region As           f            should be symmetric about its mean           and often we are interested in both up and          downregulated genes we propose to take the rejection          region at the two tails of           f                        z            f                       z             C  where the constant           C   is the cutoff point and          depends on the specified genespecific Type I error          rate  As usual           C   is chosen such that the          rejection rate under           H            is exactly                     where            a            V  is the corresponding cumulative          distribution function for            a            V  Using a numerical algorithm          such as the bisection method   we can solve the          above equation to obtain           C for any given           For microarray data because we are testing           H            for each gene the multiple test          problem arises and some control on it is necessary          Usually we can use Bonferronis method For instance if          we want to maintain the genomewide Type I error rate at          the usual  level then the Bonferroniadjusted          genespecific that is testspecific Type I error rate          is             N  where           N is the total number of genes to          be tested          Once           C is determined we can calculate          the power as a function of           d  the magnitude of the expression          change targeted to be detected Note that                    is the difference of the coefficients of variation          under the two conditions If                      i                        i             d can be interpreted as the change          of the mean expression levels from condition  to          condition  Otherwise it can be regarded as the          difference of variation standardized mean expression          levels Specifically we have the power function                    Unsurprisingly we can see that            d   will increase as            d  increases The effects of          having more replicates will reduce the variability of           f             leading to larger            d   for any given           d                           Calculation of replicate numbers          Now we describe how to calculate replicate numbers          based on some pilot data taken from earlier studies We          use           z                     m            i  to explicitly denote the           z                       i            scores in  with           m replicates Based on the data we          can estimate the density function           f                      m             z                      g   of           z                     m            i  values as a normal          mixture                    From now on we treat           f                      m  as known in Equation                    With estimated           f                      m   we want to estimate the          density function           f                      mk  for           z                     mk            i   the           z                       i            scores based on           mk replicates with           k   If we can have an          estimate of           f                      mk   then we can obtain the          corresponding power function            d   for           mk replicates in the same way as          described earlier for m replicates Of course we assume          that our pilot data are drawn from only           m arrays under each of the two          experimental conditions and thus we do not observe any           z                     mk            i  based on           mk arrays However we show next          that it is possible to generate           z                     mk            i  values from           z                     m            i  values Note that we can          draw random realizations of           z                     m            i  from the estimated           f                      m  see Pan           et al    or the example          below Suppose           z                     m            i             j values for           j             k  are           k independent realizations of           z                     m            i   then it is easy to show          that                    have the distribution           f                      mk   Thus the density          function for           z                     mk            i  values is                    For example if we triple the number of replicates          the resulting density function is                    The number of components of           f                      mk  may be too large For          example if the number of components is           g              for           m            n   the corresponding numbers of          components for           m            n             m            n   and           m            n   are respectively           g                        g              and           g              In fact some of these          components maybe very similar or have a negligible role          hence the form of           f                      mk   may be simplified In the          extreme situation as           mk   by the Central Limit          Theorem the mixture model will reduce to a          singlecomponent normal distribution Hence we propose a          simulationbased method to select a more parsimonious          model for           f                      mk            On the basis of the mixture model           f                      m  in Equation  we can          generate a random sample of           z                     m            i             j values   from which we can          calculate           z                     mk            i  values using Equation           Using           z                     mk            i  values we can fit a normal          mixture model for           f                      mk   As we shall show later          we find such a fitted mixture model often contains a          smaller number of components than           g           k             as dictated in Equation           leading to a simplified form of           f                      mk                            Summary of the proposed method          In summary our proposed method of calculating the          required replicate number works in the following          steps                    Step  Suppose that we have pilot          gene expression data           X                       ji            and           Y                       ij            from           m arrays under each condition Use          formula  to calculate the scores           z                     i            m                      Step  Use           z                     i            m  and the normal mixture model           to estimate           f                      m                      Step  For a specified Type I          error rate  determine the cutoff point           C for the rejection region using          formula  in which           f            is replaced with the estimated           f                      m                      Step  For any specified           d  calculate the power function            d   using formula  in which           f            is replaced with the estimated           f                      m                      Step  For any given           k   use formula  or  to          estimate           f                      mk                      Step  For a specified Type I          error rate  determine the cutoff point           C for the rejection region using          formula  in which           f            is replaced with the estimated           f                      mk                      Step  For any specified           d  calculate the power function            d   using formulae  in which           f            is replaced with the estimated           f                      mk                      Step  Repeat Steps  to  until          all           k   of interest have been          tried          After the power functions for many possible           mk replicates have been obtained          we can determine an appropriate number of replicates by          considering all the factors involved the desired power          and Type I error rate the targeted expression changes          and other experimental constraints                          An example          To understand the pathogenesis of otitis media a          study was conducted to identify genes involved in          response to pneumococcal middleear infection and to          study their roles in otitis media Radioactively labeled          DNA microarrays were applied to the mRNA analysis of           genes in middleear mucosa of rats with and without          subacute pneumococcal middleear infection   The          data are available for the control group and for the          pneumococcal middleear infection group A more detailed          description of how the data were collected and their          public availability was provided in Pan           et al   For the purpose of          sample size calculations and to mimic many practical          situations with only a small number of replicates we          only use           m            n   arrays from each group We          first take a natural logarithm transformation for all the          observed geneexpression levels that is radioactive          intensities so that the resulting distributions are less          skewed which will reduce the number of components of a          fitted mixture model Then for each microarray we          standardize the transformed geneexpression levels by          subtracting their median          Because of the small           m   the sample SDs may not be          stable One way is to add a small constant as suggested          by Efron           et al    Here we follow the          idea of Lin           et al    and use a loess          smoother   to nonparametrically model the sample SDs          in terms of the mean expression levels Figure  Then          we plug in the smoothed SD to calculate           z                      i   Note that an alternative          use of SD or its modification in calculating           z                      i  values will not change the          basic idea and the following steps in sample size          calculations          We fitted three mixture models for           f            with           g            ranging from  to  Table          summarizes the modelfitting results           g              was selected as both AIC and BIC          achieve their minima there So the fitted           f            is a normal distribution           N   However for          the purposes of general illustration we choose           g              as the fitted model                    f                       z               z                z            Figure apresents the histogram of           z                       i            values and the fitted           f            with           g              and  There is not much          difference between the two fitted           f             both of which fit the data well          In particular           f            does not look like a           t distribution with small degrees          of freedom as predicted from the           t test          A realization of           z                      i  can be simulated in the          following two steps First we draw a random number           p                       i            from   with probability  and           respectively Second if the drawn           p                       i                        z                       i            is randomly drawn from a normal distribution            z    otherwise it          is drawn from            z    From the          generated           z                      i  values following expression           we generated three simulated data sets           z                      k            i  values           I    for           k    and  Then a normal          mixture model was fitted to each data set From Table           it can be seen that a singlecomponent normal          distribution was selected in each case In Figure  each          of the fitted normal distributions           N             N   and           N   is compared          with its theoretically derived mixture model in Equation           they are all very close Here we see that using          simulated data to fit a mixture model results in a          muchsimplified model For example for           k   it is a fitted          singlecomponent model versus a   component model          in Equation  Note that as predicted all the means          of the fitted models are all essentially  and their          variances decrease as           k increases          If we want to have only one expected falsepositive          result from testing each of  nondifferentially          expressed genes the genespecific or testspecific          Type I error rate is     Using formula           and fittedmixture model           f                      k   the cutoff points           C are determined Then the power          functions            d   are drawn in Figure  which          may help make a decision on the required number of          replicates For instance if we want to detect an          expression change           d   with probability at least           and with   then six replicates are needed Also          with just two replicates the power to detect a change as          high as  is very low smaller than  Note that the          choice of           d may depend on some prior          knowledge For instance based on the pilot data we can          estimate the           d values for some selected genes          with the sample means and sample SDs substituting the          true means and SDs in the formula for           d  from which one can determine a          range of           d values of interest          Figures   give the results for testing           N    and  genes          respectively while controlling the genomewide Type I          error rate at the usual  level It can be seen that as           N increases we also need a larger          number of arrays to maintain the power of the statistical          test when other parameters are fixed For instance for           N   Figure  even eight          replicates cannot detect a change as large as           d   with  power but six          replicates can detect a change           d   with  power                            Conclusions        We have described a method for calculating the number of        replicates in microarray experiments This method is        designed for the situation where the mixture approach is        going to be taken to analyze the data Note that any method        for sample sizepower calculations has to depend on a        specific statistical test to be used in data analysis this        explains why there is a huge literature on the topic for        clinical trials However because of the close relation        between the mixture approach and the other two recently        proposed nonparametric approaches  the empirical Bayes        method   and the statistical analysis of microarray        SAM method    our proposed method can be also applied        to provide some useful guideline for designing microarray        experiments even when one of the latter two approaches or        other approaches is planned to be used for data analysis        in a later stage For instance even though the null        distribution         f          is estimated using the null scores         z                   i          in our proposal there maybe alternative ways of        estimating         f           such as using an alternative        nonparametric method for example kernel or local        likelihood rather than the finite normal mixture model        to estimate         f          or using the test statistics         Z                   i           of a large number of housekeeping genes to estimate         f           Some modifications to the test        statistic         Z                   i          and the null statistic         z                   i          are also possible especially when we consider        differential gene expression across more than two        conditions These are all interesting topics we are        investigating now        In most sample sizepower calculations some pilot data        are needed to provide reasonable estimates of some        parameters needed for subsequent calculations An        alternative is to obtain reasonable estimates from other        similar studies in the literature However because of the        rapid development of microarray technology the latter is        not likely and we expect a researcher will have to do his        or her own pilot study This was the situation we        considered in the example A particular challenge is how to        obtain good estimates of the variances of gene expression        levels from a small number of replicates In our example        we considered a nonparametric method to smooth sample        variances Some alternative smoothing methods have also        appeared in the literature But it is not clear which one        is the most desirable This is a topic for future        study        The proposed method is straightforward to statisticians        and can be implemented in many existing statistical        packages Our sample SPlus program and data are available        at              