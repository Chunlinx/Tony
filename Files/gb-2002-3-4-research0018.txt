                    Background        DNA microarray experiments have huge potential for        screening for gene expression of relevance in particular        contexts However the output of such an experiment is        often just a list of foldchanges in geneexpression        levels and so researchers face the question of whether        their hits can be trusted or not In the absence of any        knowledge of what to expect most researchers simply draw a        line at a given foldchange and examine whatever is above        it The largest foldchanges in highly expressed genes can        usually be trusted However because the correct        foldchange limit typically shifts with decreasing        intensity of expression a fixed foldchange line is        inadequate in the range of expression levels where most        genes actually lie Most papers reporting microarray        experiments cut off their candidate lists in essentially        arbitrary ways at the level that the researchers feel        comfortable with rather than on the basis of statistics        Here we present an easy but sound recipe for quantifying        statistical significance based on careful statistical        characterization of a large dataset of GeneChip        experiments        A particular feature of GeneChip arrays is that each        transcript is probed by many short snippets of sequence        instead of a single longer probe as in cDNA arrays            Therefore translating the measured probe intensities        into a global geneintensity or ratio score requires a        composite scoring function In principle the redundancy in        the probes offers a way to reduce the noise level for each        gene on the other hand finding the best estimator is        difficult and it is likely that the variability in probe        behavior will prevent a single estimator from being optimal        in all cases Studying the raw data reveals its great        complexity and the hybridization processes underlying the        measured perfectmatch PM versus singlemismatch MM        intensities prove hard to interpret physically The        principal difficulties stem first from the large number of        probes with MM intensities higher than the corresponding        PM and therefore not conforming to the usual hybridization        picture and second from the very broad intensity        distributions within each probe set        The first task is therefore to design a method that can        robustly handle such input data Second once reliable        measures for differential expression from two experiments        are obtained one would like to measure their significance        level It is now widely accepted that such measures should        be derived in an intensitydependent fashion              There are at least two independent sources of        variability to be considered first the intrinsic noise        levels related to the technology type I noise which        includes noise components introduced by the enzymatic step        used in the cRNA preparation see Materials and methods        and the fluorescence measurement scan and second the        variability encountered in biological replicates Previous        studies have addressed significance issues in both cDNA and        GeneChip arrays they have discussed significance according        to intrinsic noise levels    or focused on        variability in replicates only    or considered both        simultaneously          Highdensity oligonucleotide microarrays HDONAs are        composed of base oligonucleotide probes synthesized and        attached to a glass matrix by photolithographic techniques        As such a short oligonucleotide sequence would not give        sufficiently specific hybridization alone GeneChip uses         different oligonucleotides to probe each transcript        and each comes in two versions  the PM probe and the MM        probe In the latter the central base has been substituted        by its complement and this probe is intended to control for        nonspecificity The pairs PM MM are called probe pairs        and the full set of probes for a given gene is called a        probe set The standard picture used to interpret the        hybridization is based on the following model                           PM          I                   S                   I                   NS                   B                 MM             I                   S                    I                   NS                   B         where         PM MM is the observed brightness         I                   S          the contribution from specific complementary binding         I                   NS          the amount from nonspecific binding and         B a background of physical origin        that is the photodetector dark current or light        reflections from the scanning process The proper technique        for estimating the background and its fluctuations is        discussed in   Then thought to be positive reflects        the loss of binding due to a single substitution and          are the susceptibilities for nonspecific binding In the        ideal case which is usually assumed   and therefore the        subtraction         PM  MM             I                   S          is directly proportional to the desired signal        However the susceptibility can be strongly varying within        a given probe set        We shall focus on the following two aspects of GeneChip        data analysis first we describe a method to evaluate        ratio scores and associated quality measures In this step        we shall relax the assumption that   and consider either        the PM probes only or the usual PMMM subtraction These        cases were chosen to bracket the extremes of an ideally        performing MM probe and a poor MM Second we use the        assigned ratio scores and show how one can with moderate        effort attribute a significance level to differentially        expressed genes Our approach is somewhat similar to that        described in   in the sense that it relies on an        empirical characterization of the noise envelope and is        more distantly related to that described in   Both        these approaches were developed and applied in the context        of cDNA arrays see Materials and methods for a discussion        of the difference between our method and                      Results                  Relations between singlegene measurements          Figures and show the general trends in the relations          between the ratio measurements and their quality          measures for both the PM and PMMM cases We look at a          collection of  MuKsubA chips hybridized to mRNA          extracts from different mouse brain regions see          Materials and methods There are  internal pairwise          comparisons possible for each of the  genes We          randomly picked  ratios out of the possible           for plotting these figures For the purpose of          the present discussion we believe the trends are well          captured by the set of ratios shown we picked this          dataset because compared with other datasets we studied          the ratios span a relatively large dynamic range The          arrays were locally normalized as explained in Materials          and methods The main observation is that the three          quantities the logratio LR the standard error SE          and the Wilcoxon rank sign test           p value show little correlation          with each other and therefore represent relatively          independent indicators see Materials and methods for          the precise definitions The lines indicating a          signaltonoise ratio of  clearly show that the vast          majority of the measurements are well defined especially          for the larger logratios The behavior of SE when the          number of probes            N           good  retained for deriving the ratio          score is small as indicated by the colored dots is well          understood in terms of the number of residuals considered          in the LTS method that is genes with           N           good   necessarily have SE   The          only obvious correlation is that small           p values are not compatible with          LR   as shown by the valley along LR   in the          contour plots of LR versus           p It is however possible to          achieve very small           p values for tiny foldchanges as          small as  The PM and PMMM methods show very similar          features overall the biggest difference being that           p values tend to be larger for          large LRs in the PMMM which reflects the overall          smaller number of           N           good probes usable in that method          there are more probes lying below background after the          subtraction          The difference in the logratios from the PM and PMMM          methods is illustrated in Figure  Although there is a          branch with LR   from the PM method when all           p values are considered this          branch rapidly disappears when focusing at smaller           p values only Cases where the PM          and PMMM scores indicate regulation in opposite          directions are virtually absent when           p   However one can see a          compression effect in the scores from the PM method          shown by the edges with slope   near the regions          indicated by the arrows in the bottom right panel this          can also be seen by comparing the upper two contour plots          of Figures and  This compression probably reflects          crosshybridization effects that are not corrected for in          the PMonly method However if one is more interested in          finding significant changes than in the LR values          themselves the determining quantity is the LR value          divided by the width of the local noise Therefore          compression in the scale is not dramatic as long as the          noise envelope also shrinks see Discussion          A comparison of the LRSE signaltonoise ratio SN          from both methods emphasizes the complementarity of both          methods Figure  as there is clearly a similar          fraction of genes that have poor SN ratios SN   in          one case but acceptable ratios in the other These are          found in the topleft and bottomright quadrants defined          by the horizontal and vertical blue lines          We have shown previously    using the same          MuK dataset that our PMonly composite ratios lead to a          reduction in variance especially at low intensities          when compared to the Microarray Analysis Suite           available at that time                          Noise structure          In Figure we show typical scatterplots with          increasing levels of overall differential regulation          from duplicates to strong regulation going from left to          right Although these particular data are from a subset          of the MuKsubA chips used for Figures and  our          experience is that these are very typical of GeneChip          hybridization data from numerous chip series We shall          always refer to duplicates as experiments where the          enzymatic steps see Protocols in Materials and methods          in the target sample preparations have been performed          independently In ideal terms the scatter cloud is          thought of as consisting of two components one is just          noise from the enzymatic and hybridization steps          affecting all the genes the other reflects true sample          differences To illustrate this we give three          prototypical cases showing the data for the individual          genes and the local variance regression lines Figure           In these the second component increases gradually from          zero leftmost plot duplicates as visible in the          quantilequantile QQ plots in Figure b The nearly          straight leftmost QQ plot indicates that variable LR           closely follows a normal distribution As the amount          of true regulation increases longer tails develop that          depart from normal behavior          The fact that the noise component behaves as local          lognormal distributions is not dictated by the choice of          the variable LR  on the contrary it emerges as a          rather pleasant feature of GeneChip experiments In          Figure  we demonstrate that this lognormality occurs          very systematically we show the two best and two worst          judged by the linearity of the QQ plots and the amount          of outliers from  human HGUA duplicates collected          in a study of rheumatoid arthritis see Materials and          methods The majority of the cases look closer to the          first two examples and the PM and PMMM methods lead to          equally good lognormal distributions overall The mean          and variation in the local SD for both the PM and PMMM          methods are shown in Figure and reflect the          characteristic contraction of the noise envelope with          increasing coordinates along the diagonal It is obvious          that the PM noise envelope is thinner than that of the          PMMM at low intensity on the other hand both methods          lead to comparable local  in the flat mid to          highintensity domains where over half of the data lies          There  is approximately  so that  corresponds to          a ratio of    so  of repeated measurements          would fall within a factor of  of their mean Barring          some artifact affecting large numbers of probes          simultaneously we would expect then that approximately           of the measurements in the mid to highintensity          range are reproducible within a factor of around                                      Discussion        Our experience is that despite constant improvements        current incarnations of the arrays still behave fairly        inhomogeneously as far as their PM and MM hybridization        properties are concerned This is probably the consequence        of various sequencedependent effects first the        difference in stacking energies of singlestranded snippets        between the PM and the MM sequences can easily be in the        range of the gain in binding energies second there are        certainly kinetic effects as the hybridizations are not        carried to complete equilibrium and third there is always        the possibility of sequencedependent synthesis        efficiencies The wide range of probe set behavior is best        seen in the SN ratios in Figure  For these reasons we        believe that a safe way to proceed is to integrate the        results from both PMonly and PMMM methods For instance        considering the intersection or union of genes predicted        by either method would minimize the falsepositive or        falsenegative rates In addition there seems to be a        significant variation in the hybridization properties        across different chip series as can be observed from        simple statistics on the number of probe pairs with MM        hybridizing better than PM see Results The superiority        of the yeast chip mentioned above may of course be related        to the relative simplicity of the yeast genome compared to        that of the higher organisms        Another point worth mentioning is that the values of the        ratio scores may deviate from the real mRNA concentration        ratios in some intensity regimes as the result of various        effects such as nonlinearities in the probes binding        affinities Evidence concerning this matter has recently        been reported   This emphasizes the main point of our        work namely the importance of measuring differential        expression relative to the local noise only then can we        decide whether a given ratio score can be considered as        indicating true regulation or not        Finally the question of handling significance across        replicated experiments is a second step to be built on top        of the analysis presented above The most reasonable        approach would be to follow   namely to consider the         t statistics of the expression        ratios across the samples However one would also want to        weight the average according to the noise content in each        of the samples in a manner similar to that discussed in                             Materials and methods                  Datasets and protocols                      Mul IKsubA chips hybridized to adult mouse brain            extracts            All six brain regions were obtained from adult            monthold CD mice Dissections were carried out            in icecold buffer and tissues were immediately frozen            with liquid nitrogen Total RNA was isolated Poly A            RNA was then isolated with magnetic oligodT beads            For each brain region  g polyA RNA was converted            to doublestranded T cDNA Labeled cRNAs were produced            from the doublestranded cDNA libraries and hybridized            to chips according to the Affymetrix protocol            including the antibodyamplification step All            hybridizations were carried out in duplicate                                HGUA chips hybridized to human blood            extracts            The same protocol was used except that no polyA            isolation was done before the conversion to cDNA                                    Regression of the logratios SE          To compute expression ratios for genes measured in two          separate arrays let            x                       i                       y                       i             denote the brightness measurements for one probe          set the index           i ranges from  to the number of          probe pairs for the particular probe set  depending          on the chip series taken in the two different          hybridization arrays X and Y We investigate both cases          in which the intensities            x                       i                       y                       i             are either the intensities of the          backgroundsubtracted PM cells or the PMMM values which          need no background correction Only           N           good good probe pairs are retained          for determining the ratio and associated quantities We          discard probes that are saturated in both X and Y or          probe pairs such that PMMM   or PM   in both X          or Y Here corresponds to the standard deviation of the          fluctuations in the background intensity Not considering          such probes prevents contamination of the ratio estimates          from noisy lowintensity probes After identifying the          probe pairs allowed into the analysis the differential          expression score LR for the gene in question is obtained          from a LTS robust regression of LR                       i             log                       x                       i                       y                       i             to an intercept  LR LTS regression corresponds          to minimizing                    the sum of the           Ns smallest squared residuals             We used the default           Ns             N           good    and this parameter can be          adjusted in our scripts however we found no evidence          for changing the default An estimate of the standard          error SE for is given by           SE   Composite absolute          intensities for the gene in each experiment can be          obtained via geometric means of the            x                       i                       y                       i             probes kept in the LTS regression however these          are only indicative measures as the method was designed          primarily for expression ratios                          Wilcoxon statistics number of cells used          In addition to the SE which reports a quantitative          estimate of the error in the logratio measurement it is          also instructive to report a           p value from a paired Wilcoxon          rank sign test of the LR                       i            values Casually speaking this value is related to          the portion of the probes indicating gene regulation in          the same direction the theoretical minimum           p value           p                       min             is achieved when all probe ratios agree on the          same direction of regulation Moreover the test is          nonparametric as it is operating in rank space and           p therefore also incorporates          information about the number of probe pairs used            N           good  Namely the Wilcoxon           p value has a lower bound that          decreases with increasing sample size For instance           p           min   for           N           good   and  for           N           good   so that small           p scores can only be reached when          enough probes are used However the converse is not          true as a gene that is not differentially expressed can          have a           p value that is close to  even if          all the probe pairs are good in the above sense          Our method does not primarily aim at quantifying the          presence or absence of a gene in a particular sample          Nevertheless we report the number of probes            N           above  with intensity larger than            eff            eff  for the PMMM case for both          samples X and Y Using enough data one could compute a          probability of presence depending on           N           above  and it is likely that this          calibration would be dependent on the chip series                          Normalization and noise characterization          The measures described above are all singlegene          properties they can be computed when given just the          intensities gathered for a single gene In contrast          correcting for systematic trends also called data          massage and more important classifying expression          ratios according to their significance requires measures          that involve the entire gene population on the arrays We          stress that these techniques are meaningful only when the          number of genes probed is sufficiently large and under          the assumption that a large fraction of them does not          show differential regulation between the two tested          samples These requirements are usually met in GeneChip          experiments Normalization aims at correcting for          systematic trends that is bias as a result of dye          efficiencies and amplification sample concentration          photodetector efficiency so as to make a collection of          arrays directly comparable One must distinguish global          from local normalization in the first the intensities          of all the probes on the array are scaled by a constant          factor in the second the normalization factor can be          intensity dependent Local normalization techniques are          mostly discussed in the context of cDNA arrays             where the intensity dependence can be severe HDONAs          suffer less from bent noise structures nevertheless          local normalization has also been introduced for them             Although attractive local normalization should          not be applied blindly as it can hide real failures in          the data and create its own artifacts Our approach to          normalization is based on centering the logratio          distribution either globally or locally as in   For          the data presented in the Results section local          normalization was used however our scripts allow a          choice between the local and global schemes see          Additional data files for scripts We always normalize          an array with respect to another one and we found it          more accurate to do so at the gene rather than the probe          level we normalize the composite ratio scores           a posteriori instead of normalizing          the raw probe intensities          Turning to the noise structure significance of          regulation is quantified from a local robust regression            of the variable LR versus  where LR  log           I                       X                       I                       Y             is the logratio of the intensities and  log           I                       X                      I                       Y             is half the logproduct           I                       X            and           I                       Y            denote the locally normalized intensities of the          genes in channels X and Y We should emphasize that          estimating the local variance in this manner only makes          sense after the arrays have been locally normalized The          function   then quantifies the local logratio          variance so that the local SD is given by     We          used the R routine loess for the fitting   The          justification for using the local SD as a criterion for          significance relies upon the empirical fact that the          variable LR   follows a good normal distribution in          the case of replicate pure noise experiments see          Figure  The significance of a ratio score can          therefore be assessed using the value LRSD that is a          value LRSD   implies that the null hypothesis that the          gene is not regulated can be rejected with a           confidence level          We finally comment on the precise differences between          our approach and that in   First we found no          evidence for the inclusion of an additive term in linear          coordinates Judging by the data the noise structure is          very well captured by an effective multiplicative model          see Results Second the multiplicative noise component          is estimated in logarithmic coordinates instead of          linear and after a local normalization Finally we          estimate the local scale in the noise by an empirical          robust fit of the local variance with no           a priori model While it would be          satisfactory to have a physical model describing the          noise our experience is that it is very hard to          formulate one that accounts for the observed structure in          all cases                            Additional data files        Scripts for converting between file types are available        with this article  cdfpsc celratios celraw rawpcel        see explanatory filefor more details and at the authors        website          Additional data file         cdfpsc        cdfpsc converts a cdf file into a psc file        Click here for additional data file        Additional data file         celratios        celratios converts two PCEL files into ratios        Click here for additional data file        Additional data file         celraw        celraw converts CEL files into RAW files        Click here for additional data file        Additional data file         rawpcel        rawpcel estimates background and so on        Click here for additional data file        Additional data file         Explanatory file        Explanatory file        Click here for additional data file            